/* Created by Art-Sites Studio art-sites.org */!function(a){a.fn.aSendForm=function(b){a(this).each(function(){function c(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}var d=a.extend({answer:!1,popup:!1,popupEvent:!1,popupObj:{},onClickPopup:!1,goal:!1,postQuery:"/handle.php",closeData:1e3,dataClass:"amassage_popup",associations:null,mailTo:!1,onSend:!1,moreData:!1,bitrix:{TITLE:!1},validateRuls:!1,phoneValid:!1},b),e=a(this);if("function"==typeof d.popupObj.onClose){var f=d.popupObj.onClose;d.popupObj.onClose=function(){f(),"function"==typeof a.aCallBack&&setTimeout(function(){a.aCallBack("tada")},3e4)}}else d.popupObj.onClose=function(){"function"==typeof a.aCallBack&&setTimeout(function(){a.aCallBack("tada")},3e4)};d.mailTo||a.error("Нужно ввести Ваш E-mail"),d.popup&&("function"==typeof a.fn.bPopup?("undefined"!=typeof d.popup[1]&&a(d.popup[1]).bind("click",function(){return"function"==typeof d.onClickPopup&&d.onClickPopup.apply(this),a(d.popup[0]).bPopup(d.popupObj),!1}),d.popupEvent&&a(document).on(d.popupEvent,function(b,c){a(d.popup[0]).bPopup(d.popupObj)})):(d.popup=!1,console.warn("Plugin bPopup is not defined, popups is not work")));var g=!1;if(d.phoneValid&&("function"==typeof a.fn.mask?(e.find("[name="+d.phoneValid[0]+"]").mask("+00",{placeholder:"+1"}),e.find("[name="+d.phoneValid[1]+"]").mask("000",{placeholder:"123"}),e.find("[name="+d.phoneValid[2]+"]").mask("0000000",{placeholder:"1234567"}),d.phoneValid[3]&&(g={},g.rules={},g.messages={},g.rules[d.phoneValid[0]]={required:!0,minlength:2},g.rules[d.phoneValid[1]]={required:!0,minlength:3},g.rules[d.phoneValid[2]]={required:!0,minlength:7},g.messages[d.phoneValid[0]]={required:" ",minlength:" "},g.messages[d.phoneValid[1]]={required:" ",minlength:" "},g.messages[d.phoneValid[2]]={required:" ",minlength:" "})):console.warn("Function nask is not defined, nask is not work")),d.validateRuls)if("function"==typeof a.fn.validate){var h={errorElement:"div",errorPlacement:function(b,c){a(c).css("box-shadow","0 0 5px #ED2328"),a(c).css("border-color","#ED2328")," "!=a(b[0]).text()&&(a(c).after(a(b).addClass("a-valid-message").css("margin-top",14-a(c).css("marginBottom").replace(/px/g,"")+"px").css("width",a(c).next(".a-valid-message > p").outerWidth()+"px").css("margin-left",a(c).outerWidth()/100*70+parseFloat(a(c).css("marginLeft"))+"px").css("display","none").fadeIn("fast",function(){setTimeout(function(){a(c).next(".a-valid-message").fadeOut(60)},2e3)})),"none"!=a(c).css("float")&&a(c).next(".a-valid-message").css("margin-top",14+parseFloat(a(c).height())+"px"),a(c).focus(function(){a(c).next(".a-valid-message").fadeIn("fast")}),a(c).focusout(function(){a(c).next(".a-valid-message").fadeOut(50)}))},success:function(a){a.prev("input").css({"box-shadow":"","border-color":""}),a.remove()}};a.validator.addMethod("regex",function(a,b,c){var d=new RegExp(c);return this.optional(b)||d.test(a)},"Please check your input."),d.phoneValid[3]&&(d.validateRuls.rules=c(g.rules,d.validateRuls.rules),d.validateRuls.messages=c(g.messages,d.validateRuls.messages)),e.validate(c(h,d.validateRuls)),e.find("input").keypress(function(a){return 13==a.which?(e.validate().form()&&e.submit(),!1):void 0})}else console.warn("Function validate is not defined, validation is not work");e.bind("submit",function(){if("function"==typeof a.fn.validate&&!e.validate().form())return!1;for(var b={},c=a(this).serializeArray(),f=0;f<c.length;f++)d.associations[c[f].name]?b[c[f].name]=[d.associations[c[f].name],c[f].value]:b[c[f].name]=[c[f].name,c[f].value];if(d.phoneValid&&(d.associations.phone?b.phone=[d.associations.phone,b[d.phoneValid[0]][1]+b[d.phoneValid[1]][1]+b[d.phoneValid[2]][1]]:b.phone=["phone",b[d.phoneValid[0]][1]+b[d.phoneValid[1]][1]+b[d.phoneValid[2]][1]],delete b[d.phoneValid[0]],delete b[d.phoneValid[1]],delete b[d.phoneValid[2]]),a(this).find("input, textarea").each(function(){"submit"!=a(this).attr("type")&&a(this).val("")}),"function"==typeof d.goal&&d.goal(),b.art_post_pagetitle=document.title,b.art_mail_to=d.mailTo,d.bitrix.TITLE){b.art_bitrix=[];for(var g in d.bitrix)b[d.bitrix[g]]?b.art_bitrix.push([g,b[d.bitrix[g]][1]]):b.art_bitrix.push([g,d.bitrix[g]])}if(d.moreData)for(var f=0;f<d.moreData.length;f++)b["artsDataF"+f]=[d.moreData[f].title,d.moreData[f].data];return a.post(d.postQuery,b).done(function(b){if(d.popup&&a(d.popup[0]).bPopup().close(),"function"==typeof d.onSend&&d.onSend(),d.answer&&(b=d.answer),"object"!=typeof d.answer){var c="amassage_popup"==d.dataClass?"style = 'background: #fff;padding: 28px 44px;width: 550px;max-width: 100%;display:none;transform: translateX(-50%);'":"",e="amassage_popup"==d.dataClass?"style = 'margin: 5px;text-align: center;font-weight: 200;font-size: 27px;'":"";a("body").append('<div class="'+d.dataClass+'" '+c+"><h2 "+e+" >"+b+"</h2></div>"),a("."+d.dataClass).bPopup({autoClose:d.closeData,onClose:function(){a("."+d.dataClass).remove()},follow:[!1,!0],position:["50%","auto"]})}else d.answer.bPopup({autoClose:d.closeData,onClose:function(){a("."+d.dataClass).remove()}})}),!1})})}}(jQuery);